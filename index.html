<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis Intersecci√≥n Huaylas-Matellini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Estilos esenciales de estructura para los gr√°ficos */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            height: 400px;
        }
        @media (max-width: 640px) {
            .chart-container { height: 300px; }
        }
        /* Utilidad para ocultar secciones */
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800">

    <!-- ENCABEZADO Y NAVEGACI√ìN -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-center py-4 sm:h-16">
                <div class="flex-shrink-0 mb-4 sm:mb-0">
                    <h1 class="text-xl sm:text-2xl font-bold text-slate-900">An√°lisis: Intersecci√≥n Huaylas-Matellini</h1>
                </div>
                <!-- Botones de Navegaci√≥n -->
                <div id="nav-buttons" class="flex flex-wrap justify-center gap-2">
                    <!-- Los estilos est√°n directos aqu√≠ para asegurar visibilidad -->
                    <button class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer bg-sky-600 text-white" data-target="resumen">Resumen</button>
                    <button class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer text-slate-700 hover:bg-sky-100 hover:text-sky-700" data-target="demanda">Demanda</button>
                    <button class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer text-slate-700 hover:bg-sky-100 hover:text-sky-700" data-target="diagnostico">Diagn√≥stico</button>
                    <button class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer text-slate-700 hover:bg-sky-100 hover:text-sky-700" data-target="problemas">Problemas</button>
                    <button class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-colors duration-200 cursor-pointer text-slate-700 hover:bg-sky-100 hover:text-sky-700" data-target="propuestas">Propuestas</button>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8 mt-4">

        <!-- SECCI√ìN 1: RESUMEN -->
        <section id="resumen" class="content-section">
            <h2 class="text-3xl font-bold text-slate-900 mb-4">Resumen Ejecutivo</h2>
            <p class="text-base text-slate-600 mb-8 max-w-3xl">
                Esta aplicaci√≥n presenta un resumen interactivo del estudio t√©cnico sobre la intersecci√≥n de la Av. Prolongaci√≥n Huaylas y la Av. Ariosto Matellini. El an√°lisis identifica la demanda vehicular cr√≠tica, diagnostica fallas operativas y propone soluciones de ingenier√≠a.
            </p>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Tarjetas KPI -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200">
                    <div class="text-sm font-medium text-slate-500 uppercase">VHMD Total</div>
                    <div class="text-3xl font-bold text-sky-600 mt-1">4,500</div>
                    <div class="text-sm text-slate-400">Veh√≠culos/Hora (Punta Ma√±ana)</div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200">
                    <div class="text-sm font-medium text-slate-500 uppercase">Nivel de Servicio (LOS)</div>
                    <div class="text-3xl font-bold text-sky-600 mt-1">E</div>
                    <div class="text-sm text-slate-400">Operaci√≥n inestable</div>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200">
                    <div class="text-sm font-medium text-slate-500 uppercase">Demora Promedio</div>
                    <div class="text-3xl font-bold text-sky-600 mt-1">85.4 s</div>
                    <div class="text-sm text-slate-400">Por veh√≠culo (Actual)</div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 border-l-4 border-l-sky-600">
                <h3 class="text-xl font-semibold text-slate-900 mb-3">Hallazgos Clave y Recomendaci√≥n</h3>
                <p class="text-slate-600 mb-4">
                    La intersecci√≥n opera por encima de su capacidad. Los giros a la izquierda son los movimientos m√°s cr√≠ticos con saturaci√≥n > 1.05.
                </p>
                <p class="text-slate-600 font-semibold">
                    Se recomienda la <span class="text-sky-600">Propuesta 2 (Redise√±o Geom√©trico)</span>, reduciendo la demora a 35.1 segundos (Nivel "C").
                </p>
            </div>
        </section>

        <!-- SECCI√ìN 2: DEMANDA -->
        <section id="demanda" class="content-section hidden">
            <h2 class="text-3xl font-bold text-slate-900 mb-4">Demanda Vehicular (Hora Punta)</h2>
            <p class="text-base text-slate-600 mb-8 max-w-3xl">
                Vol√∫menes vehiculares por acceso (7:30 - 8:30 AM). La Av. Huaylas concentra la mayor carga vehicular del sistema.
            </p>
            <div class="chart-container">
                <canvas id="demandaChart"></canvas>
            </div>
        </section>

        <!-- SECCI√ìN 3: DIAGN√ìSTICO -->
        <section id="diagnostico" class="content-section hidden">
            <h2 class="text-3xl font-bold text-slate-900 mb-4">Diagn√≥stico Operativo</h2>
            <p class="text-base text-slate-600 mb-8 max-w-3xl">
                Grado de Saturaci√≥n (v/c). Barras que superan la l√≠nea roja (1.0) indican colapso del carril.
            </p>
            <div class="chart-container">
                <canvas id="diagnosticoChart"></canvas>
            </div>
        </section>

        <!-- SECCI√ìN 4: PROBLEMAS -->
        <section id="problemas" class="content-section hidden">
            <h2 class="text-3xl font-bold text-slate-900 mb-4">Problemas Detectados</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Tarjetas de Problemas -->
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-lg transition-shadow">
                    <span class="text-3xl">üöó</span>
                    <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Congesti√≥n Severa</h3>
                    <p class="text-slate-600">Vol√∫menes superan capacidad f√≠sica de la v√≠a.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-lg transition-shadow">
                    <span class="text-3xl"‚ÜîÔ∏è</span>
                    <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Colas de Giro</h3>
                    <p class="text-slate-600">Giros a la izquierda bloquean carriles directos.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-lg transition-shadow">
                    <span class="text-3xl">üö¶</span>
                    <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Sem√°foros</h3>
                    <p class="text-slate-600">Ciclo de 120s ineficiente para la demanda actual.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-lg transition-shadow">
                    <span class="text-3xl">üö∂</span>
                    <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Conflictos Peatonales</h3>
                    <p class="text-slate-600">Tiempos de cruce insuficientes.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-lg transition-shadow">
                    <span class="text-3xl">üìê</span>
                    <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Geometr√≠a</h3>
                    <p class="text-slate-600">Radios de giro inadecuados para buses.</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md border border-slate-200 hover:shadow-lg transition-shadow">
                    <span class="text-3xl">üöå</span>
                    <h3 class="text-xl font-semibold text-slate-900 mt-3 mb-2">Transporte P√∫blico</h3>
                    <p class="text-slate-600">Paraderos en zona de influencia directa.</p>
                </div>
            </div>
        </section>

        <!-- SECCI√ìN 5: PROPUESTAS -->
        <section id="propuestas" class="content-section hidden">
            <h2 class="text-3xl font-bold text-slate-900 mb-4">Propuestas de Mejora</h2>
            <p class="text-base text-slate-600 mb-6 max-w-3xl">
                Comparativa de escenarios. Seleccione una opci√≥n para ver el impacto t√©cnico.
            </p>
            
            <div class="flex flex-wrap justify-center gap-4 mb-8" id="propuesta-buttons">
                <button class="prop-btn px-6 py-2 rounded-md font-medium cursor-pointer shadow-sm transition-colors duration-200 bg-sky-600 text-white" data-target="prop1">
                    Propuesta 1: Optimizaci√≥n Semaf√≥rica
                </button>
                <button class="prop-btn px-6 py-2 rounded-md font-medium cursor-pointer shadow-sm transition-colors duration-200 bg-white text-slate-700 border border-slate-300 hover:bg-slate-50" data-target="prop2">
                    Propuesta 2: Redise√±o Geom√©trico
                </button>
            </div>

            <div class="chart-container mb-8">
                <canvas id="propuestasChart"></canvas>
            </div>

            <div id="propuesta-details" class="bg-white p-6 rounded-lg shadow-md border border-slate-200 max-w-3xl mx-auto transition-all duration-300">
                <!-- Contenido din√°mico -->
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // DATOS
            const dataStore = {
                demanda: {
                    labels: ['Huaylas (Norte)', 'Huaylas (Sur)', 'Matellini (Este)', 'Matellini (Oeste)'],
                    datasets: [
                        { label: 'Giro Izquierda', data: [150, 180, 200, 150], backgroundColor: 'rgba(239, 68, 68, 0.8)' },
                        { label: 'Recto', data: [1200, 1300, 400, 350], backgroundColor: 'rgba(59, 130, 246, 0.8)' },
                        { label: 'Giro Derecha', data: [100, 120, 50, 100], backgroundColor: 'rgba(34, 197, 94, 0.8)' }
                    ]
                },
                diagnostico: {
                    labels: ['Huaylas (N-S) Giro Izq.', 'Matellini (E-W) Giro Izq.', 'Huaylas (S-N) Recto', 'Matellini (W-E) Recto'],
                    datasets: [{
                        label: 'Grado de Saturaci√≥n (v/c)',
                        data: [1.10, 1.05, 0.98, 0.95],
                        backgroundColor: c => c.raw >= 1.0 ? 'rgba(239, 68, 68, 0.8)' : 'rgba(245, 158, 11, 0.8)',
                        borderWidth: 0
                    }]
                },
                propuestas: {
                    labels: ['Demora Promedio (s)'],
                    datasets: [
                        { label: 'Actual', data: [85.4], backgroundColor: 'rgba(239, 68, 68, 0.8)' },
                        { label: 'Propuesta 1', data: [50.2], backgroundColor: 'rgba(245, 158, 11, 0.8)' },
                        { label: 'Propuesta 2', data: [35.1], backgroundColor: 'rgba(34, 197, 94, 0.8)' }
                    ]
                },
                propuestaDetails: {
                    prop1: {
                        title: 'Propuesta 1: Optimizaci√≥n Semaf√≥rica',
                        los: 'D',
                        description: 'Soluci√≥n de bajo costo. Ajuste de tiempos de verde y ciclo a 140s.',
                        items: ['Nuevo Ciclo: 140s', 'Optimizaci√≥n de fases', 'Sin obra civil', 'Mejora moderada']
                    },
                    prop2: {
                        title: 'Propuesta 2: Redise√±o Geom√©trico',
                        los: 'C',
                        description: 'Soluci√≥n integral recomendada. Incluye carril exclusivo y reubicaci√≥n de paraderos.',
                        items: ['Carril de giro exclusivo (N-S)', 'Mejores radios de giro', 'Paraderos reubicados', 'Se√±alizaci√≥n nueva']
                    }
                }
            };

            // CONFIG GR√ÅFICOS
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'top' } }
            };

            // RENDERIZAR GR√ÅFICOS
            new Chart(document.getElementById('demandaChart'), {
                type: 'bar',
                data: dataStore.demanda,
                options: { ...commonOptions, scales: { x: { stacked: true }, y: { stacked: true } } }
            });

            new Chart(document.getElementById('diagnosticoChart'), {
                type: 'bar',
                data: dataStore.diagnostico,
                options: {
                    ...commonOptions,
                    indexAxis: 'y',
                    plugins: {
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line', xMin: 1.0, xMax: 1.0, borderColor: 'red', borderWidth: 2,
                                    label: { content: 'L√≠mite (1.0)', enabled: true }
                                }
                            }
                        }
                    }
                }
            });

            new Chart(document.getElementById('propuestasChart'), {
                type: 'bar',
                data: dataStore.propuestas,
                options: commonOptions
            });

            // --- L√ìGICA DE INTERACCI√ìN SEGURA ---

            // 1. NAVEGACI√ìN PRINCIPAL
            const navButtons = document.querySelectorAll('.nav-btn');
            const sections = document.querySelectorAll('.content-section');

            // Clases para estado ACTIVO e INACTIVO
            const activeClasses = ['bg-sky-600', 'text-white'];
            const inactiveClasses = ['text-slate-700', 'hover:bg-sky-100', 'hover:text-sky-700', 'bg-transparent'];

            function updateNavStyles(targetId) {
                navButtons.forEach(btn => {
                    if(btn.dataset.target === targetId) {
                        btn.classList.remove(...inactiveClasses);
                        btn.classList.add(...activeClasses);
                    } else {
                        btn.classList.remove(...activeClasses);
                        btn.classList.add(...inactiveClasses);
                    }
                });
            }

            function showSection(targetId) {
                sections.forEach(section => {
                    if(section.id === targetId) {
                        section.classList.remove('hidden');
                    } else {
                        section.classList.add('hidden');
                    }
                });
            }

            document.getElementById('nav-buttons').addEventListener('click', (e) => {
                if (e.target.classList.contains('nav-btn')) {
                    const target = e.target.dataset.target;
                    showSection(target);
                    updateNavStyles(target);
                }
            });

            // 2. BOTONES DE PROPUESTAS
            const propContainer = document.getElementById('propuesta-buttons');
            const propButtons = document.querySelectorAll('.prop-btn');
            const propDetails = document.getElementById('propuesta-details');
            
            // Clases para Propuestas (Activo vs Inactivo)
            const propActive = ['bg-sky-600', 'text-white'];
            const propInactive = ['bg-white', 'text-slate-700', 'border', 'border-slate-300', 'hover:bg-slate-50'];

            function renderPropDetails(key) {
                const d = dataStore.propuestaDetails[key];
                propDetails.innerHTML = `
                    <h3 class="text-2xl font-semibold text-slate-900 mb-3">${d.title}</h3>
                    <div class="mb-4">
                        <span class="text-sm font-medium text-slate-500 uppercase">Nivel de Servicio:</span>
                        <span class="text-2xl font-bold text-sky-600 ml-2">${d.los}</span>
                    </div>
                    <p class="text-slate-600 mb-4">${d.description}</p>
                    <ul class="space-y-2 text-slate-600">
                        ${d.items.map(i => `<li class="flex items-start"><span class="text-sky-600 mr-2">‚úì</span>${i}</li>`).join('')}
                    </ul>
                `;
            }

            propContainer.addEventListener('click', (e) => {
                const btn = e.target.closest('.prop-btn');
                if(!btn) return;

                // Actualizar estilos botones
                propButtons.forEach(b => {
                    b.classList.remove(...propActive);
                    b.classList.add(...propInactive);
                });
                btn.classList.remove(...propInactive);
                btn.classList.add(...propActive);

                // Actualizar contenido
                renderPropDetails(btn.dataset.target);
            });

            // Inicializaci√≥n
            renderPropDetails('prop1');
        });
    </script>
</body>
</html>